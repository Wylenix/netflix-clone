{"ast":null,"code":"import { rest } from 'msw';\nimport * as users from './db';\nimport { AUTH_URL } from '../config';\n/*pour simuler du delais*/\n// eslint-disable-next-line no-unused-vars\n\nconst sleep = t => new Promise(resolve => setTimeout(resolve, t));\n\nconst handlers = [rest.post(`${AUTH_URL}/login`, async (req, res, ctx) => {\n  const {\n    username,\n    password\n  } = req.body; // await sleep(3000)\n\n  const user = await users.authenticate({\n    username,\n    password\n  });\n  return res(ctx.json({\n    user\n  }));\n}), rest.post(`${AUTH_URL}/register`, async (req, res, ctx) => {\n  const {\n    username,\n    password\n  } = req.body;\n  const userFields = {\n    username,\n    password\n  };\n  await users.createUser(userFields);\n  let user;\n\n  try {\n    user = await users.authenticate(userFields);\n  } catch (error) {\n    return res(ctx.status(400), ctx.json({\n      status: 400,\n      message: error.message\n    }));\n  }\n\n  return res(ctx.json({\n    user\n  }));\n}), rest.get(`${AUTH_URL}/me`, async (req, res, ctx) => {\n  const user = await getUser(req);\n  const token = getToken(req);\n  return res(ctx.json({\n    user: { ...user,\n      token\n    }\n  }));\n})];\n\nconst getToken = req => {\n  var _req$headers$get;\n\n  return (_req$headers$get = req.headers.get('Authorization')) === null || _req$headers$get === void 0 ? void 0 : _req$headers$get.replace('Bearer ', '');\n};\n\nasync function getUser(req) {\n  const token = getToken(req);\n\n  if (!token) {\n    const error = new Error('Le Token est obligatoire');\n    error.status = 401;\n    throw error;\n  }\n\n  let userId;\n\n  try {\n    userId = Buffer.from(token, 'base64').toString();\n  } catch (e) {\n    const error = new Error('token Invalid. Merci de se reconnecter.');\n    error.status = 401;\n    throw error;\n  }\n\n  const user = await users.loadUserById(userId, true);\n  return user;\n}\n\nexport { handlers };","map":{"version":3,"sources":["/Users/lio/Documents/Programmation/React-MikeC/react-netflix-clone/src/mocks/handlers.js"],"names":["rest","users","AUTH_URL","sleep","t","Promise","resolve","setTimeout","handlers","post","req","res","ctx","username","password","body","user","authenticate","json","userFields","createUser","error","status","message","get","getUser","token","getToken","headers","replace","Error","userId","Buffer","from","toString","e","loadUserById"],"mappings":"AAAA,SAAQA,IAAR,QAAmB,KAAnB;AACA,OAAO,KAAKC,KAAZ,MAAuB,MAAvB;AACA,SAAQC,QAAR,QAAuB,WAAvB;AAEA;AACA;;AACA,MAAMC,KAAK,GAAGC,CAAC,IAAI,IAAIC,OAAJ,CAAYC,OAAO,IAAIC,UAAU,CAACD,OAAD,EAAUF,CAAV,CAAjC,CAAnB;;AAEA,MAAMI,QAAQ,GAAG,CACfR,IAAI,CAACS,IAAL,CAAW,GAAEP,QAAS,QAAtB,EAA+B,OAAOQ,GAAP,EAAYC,GAAZ,EAAiBC,GAAjB,KAAyB;AACtD,QAAM;AAACC,IAAAA,QAAD;AAAWC,IAAAA;AAAX,MAAuBJ,GAAG,CAACK,IAAjC,CADsD,CAEtD;;AACA,QAAMC,IAAI,GAAG,MAAMf,KAAK,CAACgB,YAAN,CAAmB;AAACJ,IAAAA,QAAD;AAAWC,IAAAA;AAAX,GAAnB,CAAnB;AACA,SAAOH,GAAG,CAACC,GAAG,CAACM,IAAJ,CAAS;AAACF,IAAAA;AAAD,GAAT,CAAD,CAAV;AACD,CALD,CADe,EAQfhB,IAAI,CAACS,IAAL,CAAW,GAAEP,QAAS,WAAtB,EAAkC,OAAOQ,GAAP,EAAYC,GAAZ,EAAiBC,GAAjB,KAAyB;AACzD,QAAM;AAACC,IAAAA,QAAD;AAAWC,IAAAA;AAAX,MAAuBJ,GAAG,CAACK,IAAjC;AACA,QAAMI,UAAU,GAAG;AAACN,IAAAA,QAAD;AAAWC,IAAAA;AAAX,GAAnB;AACA,QAAMb,KAAK,CAACmB,UAAN,CAAiBD,UAAjB,CAAN;AACA,MAAIH,IAAJ;;AACA,MAAI;AACFA,IAAAA,IAAI,GAAG,MAAMf,KAAK,CAACgB,YAAN,CAAmBE,UAAnB,CAAb;AACD,GAFD,CAEE,OAAOE,KAAP,EAAc;AACd,WAAOV,GAAG,CACRC,GAAG,CAACU,MAAJ,CAAW,GAAX,CADQ,EAERV,GAAG,CAACM,IAAJ,CAAS;AAACI,MAAAA,MAAM,EAAE,GAAT;AAAcC,MAAAA,OAAO,EAAEF,KAAK,CAACE;AAA7B,KAAT,CAFQ,CAAV;AAID;;AACD,SAAOZ,GAAG,CAACC,GAAG,CAACM,IAAJ,CAAS;AAACF,IAAAA;AAAD,GAAT,CAAD,CAAV;AACD,CAdD,CARe,EAwBfhB,IAAI,CAACwB,GAAL,CAAU,GAAEtB,QAAS,KAArB,EAA2B,OAAOQ,GAAP,EAAYC,GAAZ,EAAiBC,GAAjB,KAAyB;AAClD,QAAMI,IAAI,GAAG,MAAMS,OAAO,CAACf,GAAD,CAA1B;AACA,QAAMgB,KAAK,GAAGC,QAAQ,CAACjB,GAAD,CAAtB;AACA,SAAOC,GAAG,CAACC,GAAG,CAACM,IAAJ,CAAS;AAACF,IAAAA,IAAI,EAAE,EAAC,GAAGA,IAAJ;AAAUU,MAAAA;AAAV;AAAP,GAAT,CAAD,CAAV;AACD,CAJD,CAxBe,CAAjB;;AA+BA,MAAMC,QAAQ,GAAGjB,GAAG;AAAA;;AAAA,6BAAIA,GAAG,CAACkB,OAAJ,CAAYJ,GAAZ,CAAgB,eAAhB,CAAJ,qDAAI,iBAAkCK,OAAlC,CAA0C,SAA1C,EAAqD,EAArD,CAAJ;AAAA,CAApB;;AAEA,eAAeJ,OAAf,CAAuBf,GAAvB,EAA4B;AAC1B,QAAMgB,KAAK,GAAGC,QAAQ,CAACjB,GAAD,CAAtB;;AACA,MAAI,CAACgB,KAAL,EAAY;AACV,UAAML,KAAK,GAAG,IAAIS,KAAJ,CAAU,0BAAV,CAAd;AACAT,IAAAA,KAAK,CAACC,MAAN,GAAe,GAAf;AACA,UAAMD,KAAN;AACD;;AACD,MAAIU,MAAJ;;AACA,MAAI;AACFA,IAAAA,MAAM,GAAGC,MAAM,CAACC,IAAP,CAAYP,KAAZ,EAAmB,QAAnB,EAA6BQ,QAA7B,EAAT;AACD,GAFD,CAEE,OAAOC,CAAP,EAAU;AACV,UAAMd,KAAK,GAAG,IAAIS,KAAJ,CAAU,yCAAV,CAAd;AACAT,IAAAA,KAAK,CAACC,MAAN,GAAe,GAAf;AACA,UAAMD,KAAN;AACD;;AACD,QAAML,IAAI,GAAG,MAAMf,KAAK,CAACmC,YAAN,CAAmBL,MAAnB,EAA2B,IAA3B,CAAnB;AACA,SAAOf,IAAP;AACD;;AAED,SAAQR,QAAR","sourcesContent":["import {rest} from 'msw'\nimport * as users from './db'\nimport {AUTH_URL} from '../config'\n\n/*pour simuler du delais*/\n// eslint-disable-next-line no-unused-vars\nconst sleep = t => new Promise(resolve => setTimeout(resolve, t))\n\nconst handlers = [\n  rest.post(`${AUTH_URL}/login`, async (req, res, ctx) => {\n    const {username, password} = req.body\n    // await sleep(3000)\n    const user = await users.authenticate({username, password})\n    return res(ctx.json({user}))\n  }),\n\n  rest.post(`${AUTH_URL}/register`, async (req, res, ctx) => {\n    const {username, password} = req.body\n    const userFields = {username, password}\n    await users.createUser(userFields)\n    let user\n    try {\n      user = await users.authenticate(userFields)\n    } catch (error) {\n      return res(\n        ctx.status(400),\n        ctx.json({status: 400, message: error.message}),\n      )\n    }\n    return res(ctx.json({user}))\n  }),\n\n  rest.get(`${AUTH_URL}/me`, async (req, res, ctx) => {\n    const user = await getUser(req)\n    const token = getToken(req)\n    return res(ctx.json({user: {...user, token}}))\n  }),\n]\n\nconst getToken = req => req.headers.get('Authorization')?.replace('Bearer ', '')\n\nasync function getUser(req) {\n  const token = getToken(req)\n  if (!token) {\n    const error = new Error('Le Token est obligatoire')\n    error.status = 401\n    throw error\n  }\n  let userId\n  try {\n    userId = Buffer.from(token, 'base64').toString()\n  } catch (e) {\n    const error = new Error('token Invalid. Merci de se reconnecter.')\n    error.status = 401\n    throw error\n  }\n  const user = await users.loadUserById(userId, true)\n  return user\n}\n\nexport {handlers}\n"]},"metadata":{},"sourceType":"module"}